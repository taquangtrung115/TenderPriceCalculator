// ======================================
// üì¶ FULL JSON c·∫•u h√¨nh Tender Rule Engine (Tree + UUID + Excel + SQL Mapping + ƒê·∫¶Y ƒê·ª¶ TR∆Ø·ªúNG H·ª¢P THEO T√ÄI LI·ªÜU)
// ======================================
// üìò GI·∫¢I TH√çCH C·∫§U TR√öC:
// TenderRulesTree: C√¢y logic c√°c tr∆∞·ªùng h·ª£p x·ª≠ l√Ω theo c·∫•p b·∫≠c (TH2 ‚Üí TH2.1 ‚Üí TH2.1.1,...)
// - Id: UUID ƒë·ªãnh danh cho m·ªói rule (d√πng ƒë·ªÉ map sang action, config...)
// - CaseCode: M√£ t√¨nh hu·ªëng (v√≠ d·ª• "TH2.1.1")
// - RuleName: M√¥ t·∫£ ng·∫Øn g·ªçn t√™n t√¨nh hu·ªëng
// - Level: c·∫•p ƒë·ªô trong c√¢y (1: c·∫•p cao nh·∫•t)
// - MatchCondition: ƒëi·ªÅu ki·ªán ƒë·ªÉ rule n√†y √°p d·ª•ng (ƒë·∫∑t theo context ho·∫∑c item)
// - ActionId: UUID c·ªßa h√†nh ƒë·ªông x·ª≠ l√Ω (tham chi·∫øu TenderRuleActions)
// - AppliesToTypes: danh s√°ch lo·∫°i h√†ng √°p d·ª•ng (VATTU, VTTH, HOACHAT...)
// - IsActive: rule c√≥ ƒë∆∞·ª£c k√≠ch ho·∫°t hay kh√¥ng
// - Children: danh s√°ch rule con c·∫•p th·∫•p h∆°n
// - ParentId: Id c·ªßa rule cha (n·∫øu c√≥) ‚Äî kh√¥ng c·∫ßn thi·∫øt trong JSON n√†y v√¨ ƒë√£ c√≥ c·∫•u tr√∫c c√¢y r√µ r√†ng
//
// TenderRuleActions: H√†nh ƒë·ªông x·ª≠ l√Ω ƒë∆∞·ª£c g·ªçi khi m·ªôt rule match
// - ActionCode: m√£ ng·∫Øn g·ªçn ƒë·∫°i di·ªán h√†nh ƒë·ªông
// - HandlerName: t√™n h√†m x·ª≠ l√Ω t∆∞∆°ng ·ª©ng trong backend
// - Description: m√¥ t·∫£
// - InputPriceSource: d√πng cho h√†nh ƒë·ªông gi·ªØ nguy√™n gi√° ‚Äî ch·ªâ ƒë·ªãnh gi·ªØ theo gi√° n√†o (KH, MIN, NY, Tƒê)
//
// TenderRoundingConfig: C·∫•u h√¨nh l√†m tr√≤n gi√°
// - RuleId: li√™n k·∫øt v·ªõi rule c·ª• th·ªÉ
// - RoundTo: l√†m tr√≤n ƒë·∫øn h√†ng ƒë∆°n v·ªã n√†o (vd 1000, 100...)
// - Mode: c√°ch l√†m tr√≤n (NEAREST, UP, DOWN)
// - ExcelFormula: c√¥ng th·ª©c excel t∆∞∆°ng ·ª©ng n·∫øu c·∫ßn xu·∫•t
{
  "TenderRulesTree": {
    "Id": "7b5b1740-b3e3-4967-9f3d-d8ac8b74a001",
    "CaseCode": "TH2",
    "RuleName": "T·ªîNG KH ‚â• T·ªîNG MIN",
    "Level": 1,
    "MatchCondition": "context.Total_KH >= context.Total_MIN",
    "ActionId": null,
    "AppliesToTypes": null,
    "IsActive": true,
    "ParentId": null,
    "Children": [
      {
        "Id": "a1c948db-dc97-4b59-95f6-b78a98e3fc11",
        "CaseCode": "TH2.1",
        "RuleName": "T·ªîNG MIN <= KH <= NY",
        "Level": 2,
        "MatchCondition": "context.Total_MIN <= context.Total_KH && context.Total_KH <= context.Total_NY",
        "ActionId": null,
        "AppliesToTypes": null,
        "IsActive": true,
        "ParentId": "7b5b1740-b3e3-4967-9f3d-d8ac8b74a001",
        "Children": [
          {
            "Id": "f23532ea-193e-4c63-91bb-8892385a02df",
            "CaseCode": "TH2.1.1",
            "RuleName": "MIN < MAX",
            "Level": 3,
            "MatchCondition": "item.Price_MIN < item.Price_MAX",
            "ActionId": "ac01",
            "AppliesToTypes": null,
            "IsActive": true,
            "ParentId": "a1c948db-dc97-4b59-95f6-b78a98e3fc11",
            "Children": []
          },
          {
            "Id": "fb58f1a1-30bb-496e-94d2-c8cbac86bb42",
            "CaseCode": "TH2.1.2",
            "RuleName": "MIN ‚â• MAX",
            "Level": 3,
            "MatchCondition": "item.Price_MIN >= item.Price_MAX",
            "ActionId": "ac02",
            "AppliesToTypes": null,
            "ParentId": "a1c948db-dc97-4b59-95f6-b78a98e3fc11",
            "IsActive": true,
            "Children": []
          }
        ]
      },
      {
        "Id": "0a21280f-2d00-4e88-9cf0-2e0b302f87bc",
        "CaseCode": "TH2.2",
        "RuleName": "T·ªîNG Tƒê <= KH < MIN",
        "Level": 2,
        "MatchCondition": "context.Total_TD <= context.Total_KH && context.Total_KH < context.Total_MIN",
        "ActionId": null,
        "AppliesToTypes": null,
        "IsActive": true,
        "ParentId": "7b5b1740-b3e3-4967-9f3d-d8ac8b74a001",
        "Children": [
          {
            "Id": "ce80fa33-ea79-4011-bf91-41e5b75f6e50",
            "CaseCode": "TH2.2.A2.1",
            "RuleName": "KH < MIN",
            "Level": 3,
            "MatchCondition": "item.Price_KH < item.Price_MIN",
            "ActionId": "ac03",
            "AppliesToTypes": [ "VTTH", "HOACHAT_CONTROL", "HOACHAT_CHINH" ],
            "IsActive": true,
            "ParentId": "ce80fa33-ea79-4011-bf91-41e5b75f6e50",
            "Children": []
          },
          {
            "Id": "baedbb36-6e4d-49d1-9a13-0f0143db100b",
            "CaseCode": "TH2.2.A2.2",
            "RuleName": "NY < KH",
            "Level": 3,
            "MatchCondition": "item.Price_NY < item.Price_KH",
            "ActionId": "ac01",
            "AppliesToTypes": [ "VTTH", "HOACHAT_CONTROL" ],
            "IsActive": true,
            "ParentId": "ce80fa33-ea79-4011-bf91-41e5b75f6e50",
            "Children": []
          },
          {
            "Id": "99dc5ee2-bd26-4b9e-b1f1-4e3a9d185978",
            "CaseCode": "TH2.2.A2.3",
            "RuleName": "MIN <= KH <= MAX",
            "Level": 3,
            "MatchCondition": "item.Price_MIN <= item.Price_KH && item.Price_KH <= item.Price_MAX",
            "ActionId": "ac01",
            "AppliesToTypes": null,
            "IsActive": true,
            "ParentId": "ce80fa33-ea79-4011-bf91-41e5b75f6e50",
            "Children": []
          },
          {
            "Id": "fda92fa1-3456-42e1-898f-e84b58cbdd01",
            "CaseCode": "TH2.2.A2.4",
            "RuleName": "MAX < KH <= NY",
            "Level": 3,
            "MatchCondition": "item.Price_MAX < item.Price_KH && item.Price_KH <= item.Price_NY",
            "ActionId": "ac02",
            "AppliesToTypes": null,
            "IsActive": true,
            "ParentId": "ce80fa33-ea79-4011-bf91-41e5b75f6e50",
            "Children": []
          }
        ]
      },
      {
        "Id": "20e7c86c-f181-47e3-a987-1e6f3b6f7fc7",
        "CaseCode": "TH2.3",
        "RuleName": "KH < T·ªîNG Tƒê",
        "Level": 2,
        "MatchCondition": "context.Total_KH < context.Total_TD",
        "ActionId": "ac04",
        "AppliesToTypes": null,
        "IsActive": true,
        "ParentId": "7b5b1740-b3e3-4967-9f3d-d8ac8b74a001",
        "Children": []
      }
    ]
  },

  "TenderRuleActions": [
    {
      "Id": "20e7c86c-f181-47e3-a987-1e6f3b6f7fc7",
      "ActionCode": "KEEP_INPUT_PRICE",
      "HandlerName": "ApplyKeepInputPrice",
      "Description": "Gi·ªØ nguy√™n gi√° ƒë√£ ch·ªçn (KH/MIN/NY/Tƒê)",
      "InputPriceSource": "KH"
    },
    {
      "Id": "20e7c86c-f181-47e3-a987-1e6f3b6f7fc7",
      "ActionCode": "SEQUENTIAL_REDUCE",
      "HandlerName": "ApplySequentialReduction",
      "Description": "Gi·∫£m gi√° l·∫ßn l∆∞·ª£t t·ª´ng m·∫∑t h√†ng ƒë·∫øn khi th·ªèa"
    },
    {
      "Id": "20e7c86c-f181-47e3-a987-1e6f3b6f7fc7",
      "ActionCode": "SHOW_USER_CHOICE",
      "HandlerName": "AskUserToSelectInputPrice",
      "Description": "Y√™u c·∫ßu ng∆∞·ªùi d√πng ch·ªçn gi√° KH/MIN theo t·ª´ng item"
    },
    {
      "Id": "20e7c86c-f181-47e3-a987-1e6f3b6f7fc7",
      "ActionCode": "DISABLE_REDUCTION",
      "HandlerName": "DisableReduction",
      "Description": "Kh√¥ng √°p d·ª•ng quy t·∫Øc gi·∫£m gi√° - gi·ªØ nguy√™n"
    }
  ],

  "TenderRoundingConfig": [
    {
      "Id": "20e7c86c-f181-47e3-a987-1e6f3b6f7fc7",
      "RuleId": "f23532ea-193e-4c63-91bb-8892385a02df",
      "RoundTo": 1000,
      "Mode": "NEAREST",
      "ExcelFormula": "=ROUND(A2, -3)"
    },
    {
      "Id": "20e7c86c-f181-47e3-a987-1e6f3b6f7fc7",
      "RuleId": "7b5b1740-b3e3-4967-9f3d-d8ac8b74a001",
      "RoundTo": 1000,
      "Mode": "NEAREST",
      "ExcelFormula": "=MROUND(A2, 1000)"
    }
  ]
}
